inputs=[
'O.#.#..OOO...#..#..O##..#...#.O#O.#O#...#O...OOO...#..O.....O.....#..#.O.#.........#.O#...#.OO....O#',
'O...O##O....O.#.#...#..#O..........#.....OO.O#.O...O.O#....O.O..O....#.#...OOO....O...O.....#.O.OO#.',
'..OO..O.#...#.#..O#.....#.O###..#.....O.O.O......#..........#...#..O.#.O..O..#OO.#......O.#O..#...O.',
'.#O..O...##..#.O.#...#..##.OO...#O.O...O.#..#O#O.O.#..........#.O...OO.....O#......O..O#OO...O#..OO.',
'.O#.#...O..O...OO....O.O..#.......O.#..O.#..#..O...#O.OO..#O.OO.O......O.......O..O..#...O..O.O#....',
'...OO..#..O.##....O..#.OOO..#......O#..OO..#.#..#.#......O...O.....O.OO....#...OO#...O...#.OO.O....#',
'..O#.#.#.##.#.#....#.O#...#..O##...#..O...O...#.O..#.O.OO.....O.O....#...O##.O.O.........O.O##...O#O',
'O.#O#....O....O..OO#O.O.......#.OO.O.##O..#..OO..#OO.#O...##..O..#..O#....#..#....O###......O..#...O',
'#OOO....#O#.O#.O.....O.OO......##....O......#OO...O.O.O#O#....O..O.......O.#.#.OO#O..O...#O.#....#.O',
'..O..O....#....#.#...##.#OO.....O.#O..#O........O.....#O.#...#O###......#.O...#.....OO....#.O.......',
'.O.##OOO..O..OO........OO#...O....O.O#.###...##......##..#..O....O.O#O.....#O....O.#..#O#.#....#.O..',
'.##O#O#..O.OOO......O.O.###.#..O.#.##O..O..#.##O.##.....O.O#.O#...OO.#.O.O.O..#..O..#OO...OOO......O',
'O#...##O......O#........O..#...O.#.O.##....O...#....O..#.#....O.#..........O.O..#O....OO.....O.#....',
'..O....#O...O#..O#.....#.....OOOO.OOOOO#..O....#.....#.O#..O...#.........O.....O....#O#....O..OO.O..',
'.#O.#..#..##...#.#O##O...#O....#.O.O.O....O.#......O........##.OOO...#......#..#..O.#..#O.O.O.O.#.O.',
'O....O..#.O##..#..O.##.O...O...O.#.....#....#.........OO.#O.OO...OO..O.O#...O...O.....#..#.O..#O....',
'O..#......#.##.O#..#O.....O#......O......#........###O#O.....OO.....O.##.O.O.O.##.##..#.O.....O....#',
'O..#...#O.#.OOO..........O.O..###.....##..#.##.O..##.....O..#OO...##...O#O#.O...O..O#.##...O..#O....',
'......O.......#....OOO...#O.O.#....OO#.#.#.##...O...#...O.OO....O.#.###..O.O..O##O.....O............',
'.....O..#.........O#....O#.O......##.O.....#.##OO....O...O.....#..O.OO.O..#..#.....#O..O.#.#..O.O#.#',
'...#......#.O.O.O.O#...#O....#.OO.......O..#..#.O.#......#.#.O##..O....#.#...O#...O...#..#.O....O#.O',
'O#.O..#.OO......O.O#.O.#.O.O#....O..OO.O..#.....#.....OOOO..##O#.O.......#...........O.#.#.O....OO#O',
'O....#.OO##.##.O..#.OO...O...O.O.#......O..O...##.#...#....OO..#....O.O..#O..#.....#........O....#O.',
'#O.O##..#O.#OO.#....OO#...O#.##.#.##...O....O...#O..O....#O#.#..#....O..O.#..#OO..O#..#O..O....O..O.',
'O.#O..O.O#..#...O.O..O.OOO.OO...OO#OO.O.O.OO#..#.#.........O#...O..O#..#.....OO.....#..OO...#...#..O',
'#...#....O#....#....#..#..........O........OO..#...OO.....O..OO#O..O..O..O..##..#....#.O.O....#.O...',
'#....O...O#O#......O...O...OOO.....O.O...O.OO#...O....OO.....O..O....O.O#..OO.O.#.O.O...O.O#.O#.....',
'.#....O....##..O.O.##...#.#OO.#.#OO......#.......O....O..#..##.#O...##O.O.#...#..O.O#....O....#OO.#.',
'.#.OO...#.OOOO......#.O.O...O.O...#....O....#.O..#OO....O......OO.....##.#.OOO#..#.#O#.....O....#..O',
'.....O.....O#..O.O.##O.O.#...O#OO...#....#O.........##...#.....#.O.O#..O.........OO..O...#......#.#.',
'.........O.#.#..O..#.#.OOO#O..##O..O#..OO...O.O#.O...###.........O...O..O..O...#O..O....#..#...#O.OO',
'.#O..O....#..##.....#..O.OO...#.#OO.#.#........##.O.....#..........#.#.O#O..OO.OO.#...O....#...O...#',
'.O.O....#OO.#..O...O...O#.OOO#......#.O...O...##.OO..#..OOO.#.#OO......##OO....#....###.O#...#O#...O',
'.O#.....#...#O.O.....O...#.O#O....O.O....#..#####..............O.#...O#O#OOOO...#.#...O..O.#.OO.O..#',
'...#.#..O.#......O...O##.#....#.O......#.....O......#O#.O.OO....OO..#O.O.#.O.#...O#..O##.#O.O..OO.O#',
'##OO...O....O.##..O.....#..OO##.#.#.O..........O#.O....O##...O.O....#O..O.O.##...#.#O##.......OO...O',
'#O.#.......#........O......O....#........#O##..O.O..OO..O......OO.....O#O..OO.#......#O.....#.......',
'....OO...OO.#.#...#..........O#....O#.#.#OOO..#......#.OO#..#O..........O..O....#....O..O.....#.....',
'.......##O.....#O..#OO..#OO..#O.....O..O.#.O#OO........O.O..O..O......OO...#...OO#.#.##O...#O..#..#.',
'O......#..O#.........#O.OO#O..#.O......O.#.O.....##..#.O.....OO..O.#..O...O.#...O#.O.#O..O..#...OOO#',
'..O.O##...O..OO#....#O...OO.....#..O.O.........OO#....O..#...OO...............OO.O...#........#OO.O#',
'#.....O.....O.#.....O..#O#O#..#.O.#.O...O.O.#.O...#O..#..O.O....O.O..##.#OO.#.O..................O#.',
'...O....O.OO...O.OO.O......O......O.O#.OO.....O.O..#...O#O#.......#.#OO..#...O..#..O..OO..OOOO.O.O..',
'.#..OO.O...#.O.....#...##.O....#.....#OO#O.#..#.O...........#O..O....O....#O...O....#.#...O#....O...',
'....O..####...O..........O..OO.#.#..#....##...##.O.#.....O.#O.#...##.......OO.O.......#.#O.O.O.#..O.',
'#..#..#.OO..#.#..#####..O#OOO..OO.#.##.O.O.O.O..O...O.O###.....#.#.#........O.O....#.O...#.#.#.....#',
'.OO.#O...##...#..O..#O..O.#.#O........O..#..O....O..#..OO.O...#..#.#......#..#O........##.O.....O...',
'O.....#.O.O.#..O.#..O...OOO..#.OOO#..O......O#..O..O#...#O#...O..........O...O.O##....O.O.O.....O..O',
'#.#O.O.#O#...O..#.#......##..O.OOOO....O.#.....O..O..OO....O.O##....O#.#..O.O.O#.......OO..#O.......',
'...O...#......O#.O#..O###.......#.O....O#O.#.O.O#..O##...#....O..OOO....O..O.....#..#O.....O.OO.....',
'O..O....#O#....#..O....#..##..........O..#.OO.....OO.O.#O..#O.O#O....OO.O....#.O.#O.OO...#..#..O...#',
'#.O#OO.OO#.O#.#....#.......O..OO...#.O...OOO.O..O...OO#..O..#.O..#..OO....#.#......#O......#.O..O..O',
'.#.......#....#.O#O..O..........#.O.O.......##.#.O#####.....O.O.....#....O.#.O...O...OO#.#O.O##.....',
'O.O......OO....#.#........##.O.#.O.#...O#OO......O..#.O...O.O..O#.....#O#.OO#....OO.#.#....#..#..#.O',
'O.....OO...#O...#.O..O.....O.OO.#.##.OOO##..#.O.OO.##...O.O.......O.#......#.O#.....O.#..O...O......',
'......O.##.#.............O.O.O#.##..#O#O..O..O.#.O.#O..#....#.......O.......O...O#..###.OO...O#OO...',
'O.#..##O..#O......O.#.#.OO.O#O.O##..O.OO..OO#.OO...O..#.#...O...O.#.#...O....O#...##..O#......#...OO',
'...OO...O#.O.O......O...#..O##.#OOOO.O.##O....O##..#...O.OO.......##..OO#.O......O#O...O..#.......O.',
'..#.O#O#.O#......#....O.OO..O#.O..#.....O....#..OO#.#.O#.O........O..OOO#OO.OOOO..O.....#.O...#..#.#',
'.O.....#.#.#.#O.......O..O#..#O#.....O.##.......OO......#OO.....#OO.#.....##...O.O...O..O..O......##',
'.O#.#O...#..#.OO#OO#.O.O.......#..OO#.#O.O#O.O.##..O..#.....OO#.....O..O..OO.O.O#.#.#..O.......OO.O.',
'.#OO..#.......O.O....#....O...O..#......#.#OO.O#...O..O..O.###.....#.#............O....O....O.OOOO.O',
'OO..#O#...#O..##.........O#...#......O...#....O....#O......O.......#.O.......##...#OO...#..###...###',
'#.O#O#OOO...#.......O......O...#O..#......#....OOO.#O.....O....#....##.O#.#....O.O........#..#.O...#',
'.O...#..##O..O..##.O#....OO#..#O#OOO.OOO#.#.#..#.O.....O#O..O.O..#..OOOO..O..O...#.#.#..O.O....O....',
'...#.OOO.OO....O#O#....##..OO...O..O..O......O...#O#O...O.#O..##O.......O..O#.......##O..........OOO',
'.....OO...O....OO.O..O..O##..OO...#.O.##...O.##.#..#O..........O....O...O.OO..O..O#..O.#..O#..#.O#..',
'.O..O#.O.O.#...O...O.O......O..O..OO..OOO#..O.....#...O#..###..O.O.....#..##...O#....#.O.......#...O',
'.O........O#O.#.#O#O...O.O...#O...O..O........O#O.##..O...#.....O..O........O#.#...O..OO..O...O#O...',
'#.##..#O....#..O...O##..##..O..#....##O...#.O.#...##...O.O..O#O..O.#.....O...O#......OO....O.#....##',
'O#..#O...#......#OOOO..OO.#O.....O..OO..#.....#..O....O....OO..#...O.O.....O#...#.......O#..O.......',
'#O...O........O##O.#....O..O...##.#O...O.O.O......O....O.O#.O#O....#.O....O#....##O.#..O....##.O..OO',
'..#....O.##...#.#O#...#..O....#...#.#..O..#..#.O.#.O..####.O.O.####.OO..OO...OO...#....OO.##O.O.#.O.',
'..OOOO..#.....O...#O#O.O.....#....##....O..O....O..O.O.....O.#..O..#O....O.OO..OOO#..#.#O...#.#..O..',
'.#.O......#..O#.#..##.###..#..#.....##......#...#O.#.O..#O..O.O..O.#..#OO.O.#O.O......#..#...O....#.',
'..#...##.O....#..OO...#O.#..O..#OOO..O.O.....O.#OOO#O....O........O#...O.#..............O.....#.O.#O',
'......O.OOO.#..............#O...#.O........#..O.......O.....#.O..#O........#O##..O##O#.....O.....O.O',
'.#.#....OO.##...OO...O#O.O.#.O..O.O.O...#...#...........O...O.O##.#..#O..O.....O#....O..#.....#....#',
'.O....O#O.#.#.O..O..#....#..O.OO...#.O.....#O...........O.......O....O......##.....OOO..#......O.O#.',
'##...#...O.....O......OOO#...#O...O##.......#O..O......O......O..O.#.O#O..O..O....O.....#..O...O...#',
'......O#.#...#.O.O#.##.#O#OO.##.O#.....O.O..O....O.O#.......O#OO...O...#.....O#...#.#..O.O..#O#..O##',
'OO.#.OO#..#....O.#O#.O..#...#O..OO...#O#.O.O..O..O.O.######O..O#....O#..O.O.....O##.O..O.O#O.##O.O..',
'...O...#...O..#...O.O.O..#OO.O.#O.#.O.....O#.OO..O.#.O.....#.O.#.OOO..O#OO.O....O...O##........O#O..',
'..#.....O........O#.OOOOO...O.#....OOO.#.O.#..O#O#O..#.#O.O.#O.#O##O........O...#.OO.#.........O.O.O',
'.....OO...O..#O.O..OO#O...#O........O.O.##......O..#..#OO.....O..###.........O...#....O......OOOOO..',
'......#...O.....#...#.O.##.OO..O#.O..O.#.#.O.....O......#O.#O.#O#O...O...O..O#.....#.#O#..#.O.#..#.#',
'OO.#.O..#...OO##..OO....O.#.O###...#.O......OO#....O.....O..#O...#.....O#OO......O.......#.O..#.##O.',
'.#O....OO.#.#...O......O..O#..O#.O......#O..O#.##...O#...#O#....#.OO..#........O#...O#.O....#....##.',
'.#.OO....#.#.....O#O.O##O.##O.O.#..##O#..#.#.#O#.OO..O.....###.O.#...##.....#.....O......OO.#O.O..#.',
'.#O....O.O.O.OO.O..OO...O.###O...O....#.O.OO#O..#....O.##O...O....#OO..O..O...O.#...O..O.#.O...O.#.#',
'..O........O.O#..#.#.O.O.......OO.#.O...##..O#.#.......#..#...#.#...O.....##.O........#O..#OO.....#.',
'##...O....O.#.....OOO.#...O.#.........#...#....#.#..#......#..O..##O#.O..O.#.O.##.#........O#.....#.',
'...O..#O...O......O.#O..#.##...O...O.......OO.#...........O..#.#...OO#....................#O#OO#O...',
'O#..#O.......O.#OO....O.......OO.O......O.#.....O......#.O.##..O.O#..OO..##O.....###.O...O....OO.O..',
'.O....#....O...#.O..O.#......O#..O..#OO..O..##...O..O...O.#..O.....O#O.#.OO...#.#.....O#......O...OO',
'..O.OO...OO...O..O.O.OO.O.#....OOO...O...##O.#O...#....#O.#O.O....OO..O..........O.O.....#.....#OO#.',
'.OO#...O.#..O.#.OO..O...O.O...##.....#O.#.O.....O...O....#.O...O.##......OOO....O....O.....#.#.O..O.',
'......#..#...#O.##...O..#OO##...#....#.#.......O.##.##..OO#O.O.....#..O#.O..#O.....#.O.O.#.#..#O#.O#',
'..#....O#..#O....#.#....O..O#...O...OO......#...#.O.#.##..#....#OOO#.O.O.O...O#...O.O.O.O...O#O...#.',
'..O.......#OO.OOO......#O#.O.#O.O......O..O.O.O.O.....#.###O.O#OO.#O.#O...O...OO##O#.........O#.....',
]
'''
moved = True
while moved == True:
    moved = False
    for r, row in enumerate(inputs):
        if r == 0: 
            continue
        #print(inputs[r-1])
        #print(row)
        #print()
        for c,item in enumerate(row):
            #print(r,c)
            #print(inputs[r-1])
            #print(len(inputs[r-1]))
            if item == 'O' and inputs[r-1][c] == '.':
                inputs[r-1] = inputs[r-1][0:c] + 'O' + inputs[r-1][c+1:]
                inputs[r] = inputs[r][0:c] + '.' + inputs[r][c+1:]
                moved = True # wrong
        #print(inputs[r-1])
        #print(inputs[r])
        #import pdb
        #pdb.set_trace()

for row in inputs:
    print(row)

total = 0
size = 100
for r, row in enumerate(inputs):
    for item in row:
        if item == 'O':
            total+= size-r

print('p1',total)
'''

#p2

from functools import lru_cache

@lru_cache(maxsize=None)
def drop_north(board):
    board=list(board)
    moved = True
    while moved == True:
        moved = False
        for r, row in enumerate(board):
            if r == 0: 
                continue
            for c,item in enumerate(row):
                if item == 'O' and board[r-1][c] == '.':
                    board[r-1] = board[r-1][0:c] + 'O' + board[r-1][c+1:]
                    board[r] = board[r][0:c] + '.' + board[r][c+1:]
                    moved = True 
    return(board)

@lru_cache(maxsize=None)
def rotate_board_cw(board):
    board_out = []
    for c in range(len(board[0])):
        board_out.append([])
        for r in range(len(board)-1,-1,-1):
            board_out[-1].append(board[r][c])
    for r,row in enumerate(board_out):
        board_out[r]=''.join(row)
    return(board_out)

@lru_cache(maxsize=None)
def calc_weight(board):
    total = 0
    size = len(board[0])
    for r, row in enumerate(board):
        for item in row:
            if item == 'O':
                total+= size-r
    return(total)

#'''
inputs=[
'O....#....',
'O.OO#....#',
'.....##...',
'OO.#O....O',
'.O.....O#.',
'O.#..O.#.#',
'..O..#O..O',
'.......O..',
'#....###..',
'#OO..#....',
]
#'''

from collections import defaultdict
def p2():
    board=inputs
    weights = []
    weight_dict=defaultdict(list)
    #for row in board:
    #    print(row)
    #print()
    for cycle in range(3000):
        for i in range(4):
            #print('drop_north')
               
            board = tuple(board)
            #for row in board:
            #    print(row)
            board = drop_north(board)

            #print('cycle, i', cycle, i)
            #for row in board:
            #    print(row)
            #print()
            #print('rotate')
            board = tuple(board)
            board = rotate_board_cw(board)
            #for row in board:
            #    print(row)
            #print()
        board = tuple(board)
        weight = calc_weight(board)
        if weight in weights:
            weight_dict[weight].append(cycle)
        #    print("cycle", cycle)
        #    print('weight',weight)
        weights.append(weight)
        if cycle % 100 == 0:
            print('cycle',cycle)
            for key, values in weight_dict.items():
                print(key, values)
        
    print(weights)
    #2612
    #2586
    return(weights)




#90539 too low
