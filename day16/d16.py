inputs=[
r'################################################################################################################',
r'#\....../...|..........|....../.../..-../.|...|......-.|..................................|.............../....#',
r'#|....-.........\..........\......./.....................................|.....-...........||..................#',
r'#.........-......|./...........\.../-......./.|...\.-.......................\....\.............................#',
r'#...............//...............\.........................\.......................\....../........./.........\#',
r'#..-........................-..........................................|............../..\.........../.........#',
r'#..........\....\../...............|--....../..............-.............|...-.....\........\.........-...\-...#',
r'#....|...|..|........................../..................-............./..\-........../|.........|...........|#',
r'#.........-.....\...................-.............|.............../....-....-....|............../....\../-.....#',
r'#.....\../\......../..|........................|.......-........................../-...|.......................#',
r'#..............|/................|........|..-......|....|.|.......|.-....\.../.............|.....-.......-....#',
r'#.-...|..................../..|......\......|./..-.....\../......................\.|..--...................../.#',
r'#.............../..|...................-........./.................../....|.............-..........|.|..\../...#',
r'#.|...........|-.........|/....\.....\...-...-.-.-......-...................................../.......\-.......#',
r'#./................./.................\..................../.-..................|.....................\.....\..#',
r'#\........-...|......|........-...................\.........................-..-........./....../.....\........#',
r'#........-../..........|........................-..-/\...\........-.../.../...-......................./\.....-.#',
r'#..//|\.........../\.......-...........\....\.....-./.|.............\...../..\.......||.......-................#',
r'#........./....\.........\-................/................................|-...\/.........|......|...........#',
r'#...|........\.../......\....../......\........./....|....../...../..|......../.-.........................\....#',
r'#../......./....|................................................................................\\.......\..|.#',
r'#.............-.\.|..........|....................................................-..........|.................#',
r'#\......|.............\..-.....................................-.|...................................-|........#',
r'#.....................-......|\......................|...-.\......-.........-.........\............//...-......#',
r'#.../.....\..................|..-/....|.......\......\........./......./../............................\../....#',
r'#....|....../.....-.............../........................../...................-...-.........................#',
r'#...................|....|.........-..../....|.......|../|...../....\................../.............|.........#',
r'#........./..\..-............................................\.....\......|...../\.\\..|..|/................\..#',
r'#.....|\......|.............../............................/............................................../...-#',
r'#...............|./../............/.\.\..............-./...................-./...|./...........................#',
r'#-...|./.........../\...-...........................|....-.....................-......\..................-.....#',
r'#....................|..|/............-./.....-\....|.............\./.............../.|.................\...|..#',
r'#..\.|.-.\.................\...........-.........-..-.......................\.....|\......./.....-..........\..#',
r'#.........|.........../............-...-...........-...-.......\.|....................-......./...|............#',
r'#...|.......|.......................|...........\................\................\............../..\..........#',
r'#/........../..-..............-................../..........\|..|..........-....\...........|-.................#',
r'#.......\.............-..................-\......................\...................-..........-..........|...#',
r'#../.....-\...............-.....\.............-....-\/..........|.-............/...............\.............\.#',
r'#............/-........../.................\...../.........|.../....................\......|........-.........-#',
r'#.......|....-...................../......../............................................/....-................#',
r'#...\....-................................-....\.\.......................././............................./....#',
r'#.......\...................../......\./.........|.......|.||....-.-.\..........-............................/.#',
r'#..|..........\..-............|...........|..-......................\................/|....-...................#',
r'#.-.........|...........-...|...../...|........../........|....................-.....-.........................#',
r'#....................../.-...../............-......\...........-...\../...-|......./...........|......-||.-....#',
r'#.........................................................-....-....../|........................../\..../......#',
r'#.........|.......|....................................-.........../.-....................-....-..........\....#',
r'#..|../-.|..........|.....|-......\..-....|/........\..|......./..\../...\....................././.|...........#',
r'#.-..................-../...........\.....................-..|/..................../........\......./..-.-....|#',
r'#.............................../...|...\|.........-........./|..........-......../.......-.....-........|.....#',
r'#.................|-.......\........-......-/-../............\....................\......//.-.....\.........-..#',
r'#............/...............-.../........|..-.........../-................\...-.........../.......\\...\\/....#',
r'#........................-..\.............\......|........|/................../..........\.//..................#',
r'#...............-.............\|-........../.|............./......................./..............|./..........#',
r'#.......\/-.....\..|................../.....\.....|...................|......|...................-.\...........#',
r'#............................................-...................................-...........-\......|.........#',
r'#................./..../...|-\......./...............|.......................-..|........................../../#',
r'#.........|...........|..................\...|........|../...|.......|............./..............|............#',
r'#.......\........................\....../.......................-..............................................#',
r'#|.-................\...|........|.\..................|..-.......|....-..|....|..................|.............#',
r'#..............-|.-...............|.........................................................../................#',
r'#........\....................|........../...........\.....|......|...................||.......................#',
r'#.....................-...............................\...\.....-....\..................-...........\..........#',
r'#..............|..\............../......-..................-....//..\|.|.\.......|.....................-.......#',
r'#.\...|........||............................/................\....|..................\.......\..............-.#',
r'#.............|...|.........../..|..............|.||../................|......|....................-....\......#',
r'#.....................\.-...........\.|...|................|........-../..............|...|....................#',
r'#....\.......\..............|.-\..................|........|../......./..-..../.........-.\...\................#',
r'#.............|\......|/.....-....-......\......../............|....\....\...........................-.........#',
r'#.........\..../................................-.................\\.....|...-..........-...........|......../.#',
r'#..........-...................-..\...............-...\........|............\..../\...|...\..........|.........#',
r'#||........\.................|......\|../...\..-...|../............................../.........................#',
r'#..................\......................-|.....\.|..........|...||.........|..........\...|..................#',
r'#............../..|.............-.....\............../........-.-......................-|.....-........|....../#',
r'#..........................................///.....|...-..|.-...................\-...........\......\......./..#',
r'#.....|.|.........................................................-.........................../|..|-...........#',
r'#..../..../......-........|.......|.....\......-./...../.............|..............\....-......./|.\.\./...-\.#',
r'#...\..........-..|...................|............................/.....\........\............................#',
r'#........\..\...-................/..\...--...................................../\.......-....../......-.....\..#',
r'#..-..................|...\......\..........-.|...\.................|..........\|...-..........................#',
r'#\.............\-...\.............../...............\...\...................../.\.-..-\.-...|............./...\#',
r'#../...|......../...........\..................\...................|.....\..|......\...../........-...../......#',
r'#..../...........|.................../|...\.....-...-........|......../.............................|........|.#',
r'#...................\................--..|..................../................................................#',
r'#.\..\.............-/\.................................../...........|....\|......./.........................|.#',
r'#............................./...................................-.............|............-/...|............#',
r'#./.............................\......................-.........\..................-...-/.............-.......#',
r'#...../..........|.....|...../.......................\.................\...........\...........................#',
r'#........||....................-..-........|......../......./.-\............../............-...................#',
r'#..........-..../...........|.-.............-...........................\.....|..|.-.....-...\...|.............#',
r'#.../.....................\.........-..|......................./....\..\..................-....................#',
r'#./.........../...............................................................-................................#',
r'#..-....//................/.................../....-.\.....-....\....\..........|......................./......#',
r'#..........................-......\....|...........\\|.........................-...\.....|...../........\......#',
r'#........|...............-...\...................../........................../.-..........\../.......\........#',
r'#........|.\.....|..\...||.............\............./............././.......\....\..................../.....|.#',
r'#..................../.................-..\......../................-....|.......................|.............#',
r'#...........|....\......./..|...............|........|............\.../................../..........\..........#',
r'#......./...|........./...-.|\................................................./................./.............#',
r'#...............|....\../..-/..............|.....................\....|...............\........../.....\.\.....#',
r'#\|......||...../.../........................../......./.....\./...-.............../............|.......|....\.#',
r'#.\./.....................|.........-.....-..../.\\..............................\.................-...........#',
r'#...........-......../.....|.......\.........|..-.....|.......\............/...-...-.-.|.|..|-.............|...#',
r'#....................\.....-./......./...................................-.........................|....|......#',
r'#..\...............|................./............/.......\./.....\.........-./...-................|||...|.....#',
r'#......|.....|...../....|......../.......\./........-..-...\.-..-.-.........................|........-\........#',
r'#|-..................\.....-.............................|../\..........||............|.|................|.....#',
r'#.................\..\.....|....................../.....-............./|...............................--.|..-|#',
r'#..|.........-.-..........-./..................././................-...........................\......../......#',
r'#.....|./-............|.......\/.....-...-........-......................\.......|.............\..|............#',
r'#......|..............|............|./...........\..-......\..\.-..../..../.../................-|....|..\......#',
r'################################################################################################################',
]

#'''
dirs = {'right':0, 'up':1, 'left':2, 'down': 3}
RIGHT=0
UP=1
LEFT=2
DOWN=3

inputs2=[[] for i in range(len(inputs))]
for r,row in enumerate(inputs):
    inputs2[r]=[char for char in row]

from collections import defaultdict


from functools import lru_cache
@lru_cache(maxsize=None)
def get_next_beams(beam):
    r = beam[0]
    c = beam[1]
    beam_dir = beam[2]

    cur_loc_action = inputs2[r][c]
    if cur_loc_action == '#':
        return([])
    else:
        energized[str(r)+'.'+str(c)] = 1

    next_beam2 = None

    ''' # Potential way to do it with a dict, but split beams makes this hard...
    dir_dict = {[RIGHT, '\\']: [1 ,0,DOWN ],
                [RIGHT, '/' ]: [-1,0,UP   ],
                [RIGHT, '.' ]: [0 ,1,RIGHT]
                [RIGHT, '-' ]: [0 ,1,RIGHT]
                [RIGHT, 
                '''
    if beam_dir == RIGHT:
        if cur_loc_action == '\\':
            next_beam = [r+1,c,DOWN]
        elif cur_loc_action == '/':
            next_beam = [r-1,c,UP]
        elif cur_loc_action in '.-':
            next_beam = [r, c+1, RIGHT]
        elif cur_loc_action == '|':
            next_beam = [r-1, c, UP]
            next_beam2= [r+1, c ,DOWN]
    
    if beam_dir == LEFT:
        if cur_loc_action == '\\':
            next_beam = [r-1,c,UP]
        elif cur_loc_action == '/':
            next_beam = [r+1,c,DOWN]
        elif cur_loc_action in '.-':
            next_beam = [r,c-1,LEFT]
        elif cur_loc_action == '|':
            next_beam = [r-1,c,UP]
            next_beam2= [r+1,c,DOWN]

    if beam_dir == UP:
        if cur_loc_action == '\\':
            next_beam = [r,c-1,LEFT]
        elif cur_loc_action == '/':
            next_beam = [r,c+1,RIGHT]
        elif cur_loc_action in '.|':
            next_beam = [r-1,c,UP]
        elif cur_loc_action == '-':
            next_beam = [r,c-1,LEFT]
            next_beam2= [r,c+1,RIGHT]

    if beam_dir == DOWN:
        if cur_loc_action == '\\':
            next_beam = [r,c+1,RIGHT]
        elif cur_loc_action == '/':
            next_beam = [r,c-1,LEFT]
        elif cur_loc_action in '.|':
            next_beam = [r+1,c,DOWN]
        elif cur_loc_action == '-':
            next_beam = [r,c-1,LEFT]
            next_beam2= [r,c+1,RIGHT]

    out_beams = []
    out_beams.append(next_beam)
    if next_beam2 is not None:
        out_beams.append(next_beam2)

    return(out_beams)



def test_single_beam(row,col,direction):
    energized=set()
    index = 0
    save_beams = set()
    beams = [[row,col,direction]]
    last_ten_energized = [0,1,2,3,4,5,6,7,8,9]
    while len(set(last_ten_energized)) != 1 :
        index = (index +1 )% 10
        last_ten_energized[index] = len(energized)
        next_beams = []
        for beam in beams:
            save_beams.add(tuple(beam))
            r = beam[0]
            c = beam[1]
            cur_loc_action = inputs2[r][c]
            if cur_loc_action != '#':
                energized.add(str(r)+'.'+str(c))
            beams_out = get_next_beams(tuple(beam))

            for beam in beams_out: 
                # Only add beams if they are unique.
                if tuple(beam) not in save_beams: 
                    next_beams.append(beam)

        beams = next_beams

    return(len(energized))

def p1():
    print('p1:', test_single_beam(1,1,RIGHT))

def p2():
    energized_vals=[]
    for row in range(1,len(inputs)-1):
        energized_vals.append(test_single_beam(row, 1, RIGHT))
    for row in range(1,len(inputs)-1):
        energized_vals.append(test_single_beam(row, len(inputs[0])-2, LEFT))
    for col in range(1,len(inputs[0])-1):
        energized_vals.append(test_single_beam(1, col, DOWN))
    for col in range(1,len(inputs[0])-1):
        energized_vals.append(test_single_beam(len(inputs[0])-2, col, UP))
    print("p2:", max(energized_vals))
    return(energized_vals)

